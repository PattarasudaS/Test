@using HomeCare_4_0.Common
@using HomeCare_4_0.ClassLib

@{
    ViewBag.Title = "Create New Permission";
    Layout = "~/Views/Shared/_MasterLayout.cshtml";
}

@section AddToHead {
    <style>
        h3.box-title {
            font-weight: 600;
        }

        .btn-group .btn {
            min-width: 85.5px;
        }

        .project-status-filter {
            border: 0;
            box-shadow: none;
            position: relative;
            bottom: 6.5px;
            right: 11px;
        }

        .list-group {
            margin: 0;
        }

        .list-group-item {
            position: relative;
        }

            .list-group-item:hover {
                background-color: rgba(128, 128, 128, .064);
            }

            .list-group-item.empty-item:hover {
                background-color: transparent;
            }

        .badge {
            background: none;
            position: absolute;
            top: 0;
            bottom: 0;
            right: 0;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #project-nav {
            text-align: center;
        }

        .pagination {
            margin: 20px auto 0px auto;
        }

            .pagination li a:hover {
                cursor: pointer;
            }

            .pagination li a {
                min-width: 38px;
            }

        #clear-search {
            position: absolute;
            right: 26px;
            top: 22px;
            bottom: 0;
            display: flex;
            align-items: center;
            font-size: 18px;
            color: #333;
            cursor: pointer;
        }

        .select2-container--default .select2-selection--multiple .select2-selection__rendered {
            box-sizing: border-box;
            list-style: none;
            margin: 0;
            padding: 0 5px;
            width: 100%;
            display: flex;
            flex-direction: row;
        }

        .select2-container--default .select2-selection--multiple .select2-selection__choice {
            padding: 0 5px;
        }

        ul.select2-selection__rendered > span.select2-selection__clear {
            position: absolute;
            right: 0;
            margin: 3px 5px;
        }

        li.select2-selection__choice {
            background-color: #6bbbc7 !important;
        }

        form .error {
            color: #ff0000;
            font-weight: 300;
            font-style: italic;
            font-size: 1.2rem;
        }

        .multiselect .dropdown-toggle .btn .btn-default {
            height: 62px;
            font-family: cursive;
        }

        .nav-tabs li.disabled a {
            pointer-events: none;
        }

        input:not([type]).validate + label, input[type=text]:not(.browser-default).validate + label, input[type=password]:not(.browser-default).validate + label, input[type=email]:not(.browser-default).validate + label, input[type=url]:not(.browser-default).validate + label, input[type=time]:not(.browser-default).validate + label, input[type=date]:not(.browser-default).validate + label, input[type=datetime]:not(.browser-default).validate + label, input[type=datetime-local]:not(.browser-default).validate + label, input[type=tel]:not(.browser-default).validate + label, input[type=number]:not(.browser-default).validate + label, input[type=search]:not(.browser-default).validate + label, textarea.materialize-textarea.validate + label {
            width: 100%
        }


        input:not([type]), input[type=text]:not(.browser-default), input[type=password]:not(.browser-default), input[type=email]:not(.browser-default), input[type=url]:not(.browser-default), input[type=time]:not(.browser-default), input[type=date]:not(.browser-default), input[type=datetime]:not(.browser-default), input[type=datetime-local]:not(.browser-default), input[type=tel]:not(.browser-default), input[type=number]:not(.browser-default), input[type=search]:not(.browser-default), textarea.materialize-textarea {
            background-color: transparent;
            border: none;
            border-bottom: 1px solid #9e9e9e;
            border-radius: 0;
            outline: none;
            /*height: 3rem;*/
            width: 100%;
            font-size: 16px;
            /*margin: 0 0 8px 0;*/
            padding: 0;
            -webkit-box-shadow: none;
            box-shadow: none;
            -webkit-box-sizing: content-box;
            box-sizing: content-box;
            -webkit-transition: border .3s, -webkit-box-shadow .3s;
            transition: border .3s, -webkit-box-shadow .3s;
            transition: box-shadow .3s, border .3s;
            transition: box-shadow .3s, border .3s, -webkit-box-shadow .3s;
        }



        .input-field label {
            font-family: 'Sarabun', sans-serif;
            font-size: 1em;
        }


            .input-field label.active {
                font-size: 1em !important;
                color: #fff !important;
            }

        .input-field input[type='text']:focus + label {
        }



        .input-field input[type='text']:focus {
            border-bottom: 1px solid rgb(8, 131, 224);
            box-shadow: 0 1px 0 0 #6bbbc7 !important;
        }



        .input-field > label > span > i {
            color: rgba(58, 133, 191, 0.75);
            position: absolute;
            top: -10px;
            left: 0;
            font-size: 1rem;
            cursor: text;
            -webkit-transition: color .2s ease-out, -webkit-transform .2s ease-out;
            transition: color .2s ease-out, -webkit-transform .2s ease-out;
            transition: transform .2s ease-out, color .2s ease-out;
            transition: transform .2s ease-out, color .2s ease-out, -webkit-transform .2s ease-out;
            -webkit-transform-origin: 0% 100%;
            transform-origin: 0% 100%;
            text-align: initial;
            -webkit-transform: translateY(12px);
            transform: translateY(12px);
        }

        /*******************************
        * MODAL AS LEFT/RIGHT SIDEBAR
        * Add "left" or "right" in modal parent div, after class="modal".
        * Get free snippets on bootpen.com
        *******************************/
        .modal.left .modal-dialog,
        .modal.right .modal-dialog {
            position: fixed;
            margin: auto;
            width: 500px;
            height: 100%;
            -webkit-transform: translate3d(0%, 0, 0);
            -ms-transform: translate3d(0%, 0, 0);
            -o-transform: translate3d(0%, 0, 0);
            transform: translate3d(0%, 0, 0);
        }

        .modal.left .modal-content,
        .modal.right .modal-content {
            height: 100%;
            overflow-y: auto;
        }

        .modal.left .modal-body,
        .modal.right .modal-body {
            padding: 15px 15px 80px;
        }

        /*Left*/
        .modal.left.fade .modal-dialog {
            left: -320px;
            -webkit-transition: opacity 0.3s linear, left 0.3s ease-out;
            -moz-transition: opacity 0.3s linear, left 0.3s ease-out;
            -o-transition: opacity 0.3s linear, left 0.3s ease-out;
            transition: opacity 0.3s linear, left 0.3s ease-out;
        }

        .modal.left.fade.in .modal-dialog {
            left: 0;
        }

        /*Right*/
        .modal.right.fade .modal-dialog {
            right: -320px;
            -webkit-transition: opacity 0.3s linear, right 0.3s ease-out;
            -moz-transition: opacity 0.3s linear, right 0.3s ease-out;
            -o-transition: opacity 0.3s linear, right 0.3s ease-out;
            transition: opacity 0.3s linear, right 0.3s ease-out;
        }

        .modal.right.fade.in .modal-dialog {
            right: 0;
        }

        /* ----- MODAL STYLE ----- */
        .modal-content {
            border-radius: 0;
            border: none;
        }

        .modal-header {
            border-bottom-color: #EEEEEE;
            background-color: #FAFAFA;
        }

        /* ----- v CAN BE DELETED v ----- */
        body {
            background-color: #78909C;
        }

        .demo {
            padding-top: 60px;
            padding-bottom: 110px;
        }

        .btn-demo {
            margin: 15px;
            padding: 10px 15px;
            border-radius: 0;
            font-size: 16px;
            background-color: #FFFFFF;
        }

            .btn-demo:focus {
                outline: 0;
            }

        .demo-footer {
            position: fixed;
            bottom: 0;
            width: 100%;
            padding: 15px;
            background-color: #212121;
            text-align: center;
        }

            .demo-footer > a {
                text-decoration: none;
                font-weight: bold;
                font-size: 16px;
                color: #fff;
            }
    </style>

}
<head>
</head>
<body>
    <ul id="mytabs" class="nav nav-tabs">
        <li id="tabSearch" class="active" disabled><a data-toggle="pill" href="#home" disabled><i class="fa fa-search"></i> ค้นหา</a></li>
        <li id="tabCreate" class="disabled disabledTab"><a data-toggle="pill" href="#create" disabled><i class="fa fa-user"></i> สร้างผู้ใช้งานระบบ</a></li>
        @*<li id="tabEdit" class="disabled disabledTab"><a data-toggle="pill" href="#editUser" disabled><i class="fa fa-save"></i> แก้ไขข้อมูลผู้ใช้งาน</a></li>*@
        @*href="#editUser"*@
        @*onclick="editUserTab(this.event)"*@
    </ul>
    <div class="tab-content">
        <div id="home" class="tab-pane fade in active">
            <div class="row" id="search-user-panel">
                <div class="col-xs-12">
                    <div class="box" id="form-box" style="margin-bottom: 0;" hidden>
                        <div class="box-header">
                            <h3 class="box-title"><span class="text text-blue text-bold"><i class="fa fa-wrench"></i> จัดการสิทธิ์ผู้ใช้งาน</span></h3>
                        </div>
                        <div class="box-body">
                            <div class="row">
                                <div class="form-group col-xs-12 col-md-6 col-lg-2">
                                    <label>ระบุชื่อเข้าใช้ระบบ</label>
                                    @*<span class="fa fa-search form-control-feedback"></span>*@
                                    <input class="form-control" id="search-text" placeholder="ชื่อเข้าใช้ระบบ" onchange="getUserDatabyDepartment()" />
                                </div>
                                <div class="form-group col-xs-12 col-md-6 col-lg-2">
                                    <label>เลือกฝ่าย</label>
                                    <select id="ddlserchDepartmentID" class="form-control" onchange="getUserDatabyDepartment()"></select>
                                </div>
                                <div class="form-group col-xs-12 col-md-6 col-lg-2">
                                    <label>เลือกตำแหน่ง</label>
                                    <select id="ddlserchRoleID" class="form-control" onchange="getUserDatabyDepartment()"></select>
                                </div>

                                <div class="form-group col-xs-12 col-md-6 col-lg-4">
                                    <label for="search-text">สถานะการใช้งาน</label>
                                    <div class="btn-group form-control project-status-filter">
                                        <button name="show-all" type="button" class="btn btn-default" onclick="filterByVisibility(this)">ทั้งหมด</button>
                                        <button name="visible-only" type="button" class="btn btn-default" onclick="filterByVisibility(this)">เปิดการใช้งาน</button>
                                        <button name="disable-only" type="button" class="btn btn-default" onclick="filterByVisibility(this)">ปิดการใช้งาน</button>

                                    </div>

                                </div>
                                <div class="form-group col-xs-3 col-md-2 col-lg-2">
                                    <label>&nbsp;</label>
                                    <div class="controls">
                                        <button type="submit" class="btn btn-success" id="btnSearchReceive" onclick="createUserTab(this.event)" data-toggle="pill">
                                            <i class="fa fa-user" aria-hidden="true" style="font-size: 14px;"></i> เพิ่มผู้ใช้ระบบ
                                        </button>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="box" id="search-result" style="margin-bottom: 0;" hidden>
                        <div class="box-body">
                            <div class="row">
                                <div class="col-xs-12">
                                    <div class="table-responsive">
                                        <table class="table  table-striped table-bordered " id="user-data-table" style="margin-bottom: 0;">
                                            <thead>
                                                <tr>
                                                    <th>ลำดับ</th>
                                                    <th>ชื่อเข้าใช้ระบบ</th>
                                                    <th>ชื่อ-นามสกุล</th>
                                                    <th>ฝ่าย</th>
                                                    <th>ตำแหน่ง</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td class="text-center">&nbsp;</td>
                                                    <td class="text-center">&nbsp;</td>
                                                    <td class="text-center">-- กรุณาค้นหาผู้ใช้ระบบ --</td>
                                                    <td class="text-center">&nbsp;</td>
                                                    <td class="text-center">&nbsp;</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>
                 </div>
            </div>
        </div>

        @*<div class="tab-content">*@
        <div id="create" class="tab-pane fade">
            <div class="col-xs-12">

                <div class="box" id="create-box" style="margin-bottom: 0;" hidden>
                    <div class="box-header">
                        <h3 class="box-title">
                            <span class="text text-blue text-bold"><i class="fa fa-user"></i> &nbsp;กรุณาเลือกสร้างผู้ใช้จากตาราง</span>
                        </h3>

                    </div>
                    <div class="box-body">
                        <div class="row">
                            <div class="col-xs-10">

                            </div>
                            <div class="col-xs-2">
                                <div class="controls">
                                    <button type="submit" class="btn btn-danger" id="btnSearchReceive" onclick="searchUserTab(this.event)" data-toggle="pill">
                                        <i class="fa fa-backward" aria-hidden="true" style="font-size: 14px;"></i> กลับเมนูหลัก
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-xs-12">
                                <div class="table-responsive">
                                    <table class="table table-bordered table-striped" id="non_user-data-table" style="margin-bottom: 0;">
                                        <thead>
                                            <tr>
                                                <th>ลำดับ</th>
                                                <th>ชื่อเข้าใช้ระบบ</th>
                                                <th>ชื่อ-นามสกุล</th>
                                                <th>ฝ่าย</th>
                                                @*<th>ตำแหน่ง</th>*@
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td class="text-center">&nbsp;</td>
                                                <td class="text-center">&nbsp;</td>
                                                <td class="text-center">-- กรุณาค้นหาผู้ใช้ระบบ --</td>
                                                <td class="text-center">&nbsp;</td>
                                                @*<td class="text-center">&nbsp;</td>*@
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>

                            </div>
                        </div>
                    </div>

                    <div id="editUser" class="tab-pane fade">


                    </div>
                </div>
            </div>
        </div>
    </div>
    @*</div>*@


    <!--  Modal Insert Success -->
    <div class="modal fade" id="modalInsertRoleSuccess" role="dialog" aria-labelledby="myModalLabel"
         aria-hidden="true">
        <!-- Change class .modal-sm to change the size of the modal -->
        <div class="modal-dialog modal-md" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title w-100" id="myModalLabel">ยืนยันการ บันทึก</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <i class="fa fa fa-check fa-2x" aria-hidden="true" style="color: #32CD32;"></i>
                    <span id="lbTxtSuccess"></span>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-success btn-sm" data-dismiss="modal" onclick="redirectURL()">ตกลง</button>
                </div>
            </div>
        </div>
    </div>

    <!--  Modal Role warning -->
    <div class="modal fade" id="modalRoleWarning" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
         aria-hidden="true">
        <!-- Change class .modal-sm to change the size of the modal -->
        <div class="modal-dialog modal-md" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title w-100" id="myModalLabel">แจ้งเตือน</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <i class="fa fa-exclamation-triangle fa-2x" aria-hidden="true" style="color:#FFCC00;"></i>
                    <span id="lbTxtWarning"></span>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger btn-sm" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Edit -->
    <div class="modal right fade" id="modalSaveData" tabindex="-1" role="dialog" aria-labelledby="modalSaveData">
        <div class="modal-dialog" role="document">
            <div class="modal-content">

                <div class="modal-header">
                    <button type="button" id="closeModal" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel2">แก้ไขข้อมูลสิทธิ์ผู้ใช้งาน</h4>
                </div>

                <div class="modal-body">
                    <!-- Card -->
                    <div class="card">

                        <!-- Card body -->
                        <div class="card-body">

                            <!-- Material form register -->
                            <form id="frmEdit" name="frmEdit">
                                <!-- Material input email -->
                                <div class="md-form">
                                    <i class="fa fa-file-text-o"></i><label for="editUsername" class="font-weight-light"> &nbsp;ชื่อเข้าใช้งานระบบ</label>
                                    <input type="text" id="editUsername" name="editUsername" class="form-control" placeholder="User Name" readonly>
                                </div>
                                <br />
                                <!-- Material input email -->
                                <div class="md-form">
                                    <i class="fa fa-file-text-o"></i><label for="editFullname" class="font-weight-light"> &nbsp;ชื่อ-นามสกุล</label>
                                    <input type="text" id="editFullname" name="editFullname" class="form-control" placeholder="Full Name" readonly>
                                </div>
                                <br />
                                <div class="md-form">
                                    <i class="fa fa-file-text-o"></i><label for="unitid" class="font-weight-light">&nbsp;ตำแหน่ง</label>
                                    <select id="ddleditRoleID" name="ddleditRoleID" class="form-control select2" data-placeholder="เลือก ตำแหน่ง">
                                        <option selected>เลือกตำแหน่ง</option>
                                    </select>
                                </div>
                                <br />
                                <!-- Material input text -->
                                <div class="md-form">
                                    <label for="search-text">สถานะการใช้งาน</label>
                                    <div class="btn-group form-control project-status-filter">
                                        <button name="btneditActive" type="button" class="btn btn-default" onclick="showUserStatus(1)">เปิดการใช้งาน</button>
                                        <button name="btneditInActive" type="button" class="btn btn-default" onclick="showUserStatus(0)">ปิดการใช้งาน</button>

                                    </div>
                                </div>

                                <br />

                                <div class="row">
                                    <div class="col-xs-3"></div>
                                    <div class="col-xs-3">
                                        <button type="submit" class="btn btn-success" id="btnSaveData">
                                            <i class="fa fa-save" aria-hidden="true" style="font-size: 14px;"></i> บันทึกข้อมูล
                                        </button>
                                    </div>
                                    <div class="col-xs-3">
                                        <button type="submit" class="btn btn-danger" id="btnCloseEditModal" data-toggle="pill">
                                            <i class="fa fa-close" aria-hidden="true" style="font-size: 14px;"></i> ยกเลิก
                                        </button>
                                    </div>

                                    <div class="col-xs-3">

                                    </div>
                                </div>
                            </form>
                            <!-- Material form register -->

                        </div>
                        <!-- Card body -->

                    </div>
                    <!-- Card -->

                </div>

            </div><!-- modal-content -->
        </div><!-- modal-dialog -->
    </div>
    <!-- modal -->
    <!-- Modal Create -->
    <div class="modal right fade" id="modalCreateData" tabindex="-1" role="dialog" aria-labelledby="modalSaveData">
        <div class="modal-dialog" role="document">
            <div class="modal-content">

                <div class="modal-header">
                    <button type="button" id="closeModal" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel2">เพิ่มผู้ใช้งานระบบ</h4>
                </div>

                <div class="modal-body">
                    <!-- Card -->
                    <div class="card">

                        <!-- Card body -->
                        <div class="card-body">

                            <!-- Material form register -->
                            <form id="frmCreate" name="frmCreate">
                                <!-- Material input email -->
                                <div class="md-form">
                                    <i class="fa fa-file-text-o"></i><label for="createUsername" class="font-weight-light"> &nbsp;ชื่อเข้าใช้งานระบบ</label>
                                    <input type="text" id="createUsername" name="createUsername" class="form-control" placeholder="User Name" readonly>
                                </div>
                                <br />
                                <!-- Material input email -->
                                <div class="md-form">
                                    <i class="fa fa-file-text-o"></i><label for="createFullname" class="font-weight-light"> &nbsp;ชื่อ-นามสกุล</label>
                                    <input type="text" id="createFullname" name="createFullname" class="form-control" placeholder="Full Name" readonly>
                                </div>
                                <br />
                                <div class="md-form">
                                    <i class="fa fa-file-text-o"></i><label for="ddlcreateRoleID" class="font-weight-light" id="lblCreateRole">&nbsp;ตำแหน่ง</label>
                                    <select id="ddlcreateRoleID" name="ddlcreateRoleID" class="form-control select2" data-placeholder="เลือก ตำแหน่ง">
                                        <option selected>เลือกตำแหน่ง</option>
                                    </select>
                                </div>

                                <br />

                                <div class="row">
                                    <div class="col-xs-3"></div>
                                    <div class="col-xs-3">
                                        <button type="submit" class="btn btn-success" id="btnSaveData">
                                            <i class="fa fa-save" aria-hidden="true" style="font-size: 14px;"></i> บันทึกข้อมูล
                                        </button>
                                    </div>
                                    <div class="col-xs-3">
                                        <button type="submit" class="btn btn-danger" id="btnCloseCreateModal" data-toggle="pill">
                                            <i class="fa fa-close" aria-hidden="true" style="font-size: 14px;"></i> ยกเลิก
                                        </button>
                                    </div>

                                    <div class="col-xs-3">

                                    </div>
                                </div>
                            </form>

                            <!-- Material form register -->

                        </div>
                        <!-- Card body -->

                    </div>
                    <!-- Card -->

                </div>

            </div><!-- modal-content -->
        </div><!-- modal-dialog -->
    </div>
    <!-- modal -->




</body>


@section Script {
    <link href="https://gitcdn.github.io/bootstrap-toggle/2.2.2/css/bootstrap-toggle.min.css" rel="stylesheet">
    <script src="https://gitcdn.github.io/bootstrap-toggle/2.2.2/js/bootstrap-toggle.min.js"></script>

    @*dataTable*@
    <script src="https://cdn.datatables.net/1.10.21/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.21/js/dataTables.bootstrap4.min.js"></script>
    <link href="https://cdn.datatables.net/1.10.21/css/dataTables.bootstrap4.min.css" rel="stylesheet">
    @*dataTable*@

    <link rel="stylesheet" href="~/assets/plugins/datatables/dataTables.bootstrap-1.10.12.min.css" />
    <link rel="stylesheet" href="~/assets/plugins/datatables/responsive.bootstrap.min.css" />

    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.1/jquery.validate.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.9.3/js/bootstrap-select.min.js" type="text/javascript"></script>


    <script>
        var role = null;
        var editUserData = null;
        var dataDepartment = null;
        var dataRole = null;
        var frmEditUserData = null;
        var frmCreateUserData = null;
        var provinceList = null;
        var AmphorList = null;
        var tamponList = null;

        var dataProvince_filter = null;
        var dataAmphor_filter = null;
        var dataTambol_filter = null;

        var allProjectList = null;
        var allProfileUsertList = null;
        var selectUserID = null;
        var vendorCode = null;
        var cancel = false;
        var tabActive = 'home';
        var isBindingEdit = false;
        var tambolEdit = null;
        var amphoerEdit = null;
        var provincekeyid = null;
        var is_active = null;
        var non_userdata = null;
        var checkEditValidation = false;
        var checkCreateValidation = false;
        var userStatus = null;
        var selectedUserId = null;


        const baseUrl = '@System.Configuration.ConfigurationManager.AppSettings["Construction_API"]';
        $(document).ready( function () {
            var showLoading = true
            if (showLoading) {
                 page.loading();
            }

        ajaxGet(`${baseUrl}/homecare/api/v1/User/@UserDetail.UserID/Permission`, response => {
                if (response) {
                    if (!response.data.length) {
                        noPermissionAlert();
                    } else if (!response.data.find(a => a.permissionDescription === 'CreateNewPermission')) {
                        noPermissionAlert();
                    } else {
                        $('#form-box').show();
                    }
                }
           });

         var tabsss = $("ul#mytabs li.active");

            ajaxGet(`${baseUrl}/homecare/api/v1/DropDown/GetAllDeapartment`, response => {
             //dataDepartment = response.data;
                if (response.data[0]) {
                    response.data[0].description = "-- เลือกฝ่าย --";
                    bindingDdlist('ddlserchDepartmentID', response.data, 0);

                }
         });


        ajaxGet(`${baseUrl}/homecare/api/v1/DropDown/GetRolseUser`, response => {
             response.data[0].description = "-- เลือกตำแหน่ง --";
            dataRole = response.data;
            bindingDdlist('ddlserchRoleID', dataRole, 0);
            bindingDdlist('ddleditRoleID', dataRole, 0);
            bindingDdlist('ddlcreateRoleID', dataRole, 0);

            });

        $('#user-data-table').DataTable({
                "processing": true,
                "language": {
                    "search": "ค้นหา : ",
                    "lengthMenu": "แสดง _MENU_ รายการ",
                    "emptyTable": "ไม่พบข้อมูล",
                    "info": "รายการ _START_ ถึง _END_ จาก _TOTAL_ รายการ",
                    "paginate": {
                        "first": "หน้าแรก",
                        "last": "หน้าสุดท้าย",
                        "next": "ถัดไป",
                        "previous": "ก่อนหน้า"
                    }
                }
        });

             $('#frmEdit').validate({ // initialize the plugin
                rules: {
                },

                messages: {
                },
                submitHandler: function (event) { // for demo

                    validateEditForm();
                    if (checkEditValidation == false) { return false; }

                    if (!confirm("ยืนยันบันทึกข้อมูล ?")) {
                        return false;
                    }
                    //SaveData();
                    $('#modalSaveData').modal('hide');
                    SaveData("edit")
                    return false;
                }

             });

            $('#frmCreate').validate({ // initialize the plugin
                rules: {
                },

                messages: {
                },
                submitHandler: function (event) { // for demo

                    validateCreateForm();
                    if (checkCreateValidation == false) { return false; }

                    if (!confirm("ยืนยันบันทึกข้อมูล ?")) {
                        return false;
                    }
                    //SaveData();
                    $('#modalCreateData').modal('hide');
                    SaveData("create")
                    return false;
                }

            });



            if (showLoading) {
                page.loaded();
            }
        });
        function noPermissionAlert() {
            modalWaring('คุณไม่มีสิทธิในการเข้าถึงหน้านี้ ขออภัยครับ');
            $('#warningModal').on('hidden.bs.modal', function () {
                window.location.href = '@Url.Content("~/")';
            });
        }

        function filterByVisibility(element) {
            if (element.name === 'visible-only') {
                if ($(element).hasClass('btn-default')) {
                    $('button[name=disable-only]').removeClass('btn-success');
                    $('button[name=disable-only]').removeClass('btn-danger');
                    $('button[name=disable-only]').addClass('btn-default');

                    $('button[name=show-all]').removeClass('btn-success');
                    $('button[name=show-all]').removeClass('btn-danger');
                    $('button[name=show-all]').addClass('btn-default');

                    $(element).removeClass('btn-default');
                    $(element).removeClass('btn-danger');
                    $(element).addClass('btn-success');
                    $('#search-text').focus();
                    is_active = 1;
                } else {
                    $(element).removeClass('btn-success');
                    $(element).removeClass('btn-danger');
                    $(element).addClass('btn-default');
                    $('#search-text').focus();
                    is_active = null;
                }
            } else if (element.name === 'disable-only') {
                if ($(element).hasClass('btn-default')) {
                    $('button[name=visible-only]').removeClass('btn-success');
                    $('button[name=visible-only]').removeClass('btn-danger');
                    $('button[name=visible-only]').addClass('btn-default');

                    $('button[name=show-all]').removeClass('btn-success');
                    $('button[name=show-all]').removeClass('btn-danger');
                    $('button[name=show-all]').addClass('btn-default');

                    $(element).removeClass('btn-default');
                    $(element).removeClass('btn-danger');
                    $(element).addClass('btn-success');
                    $('#search-text').focus();
                    is_active = 0;
                } else {
                    $(element).removeClass('btn-danger');
                    $(element).removeClass('btn-success');
                    $(element).addClass('btn-default');
                    $('#search-text').focus();
                    is_active = null;
                }

            }
            else if (element.name === 'show-all') {
                if ($(element).hasClass('btn-default')) {
                    $('button[name=visible-only]').removeClass('btn-success');
                    $('button[name=visible-only]').removeClass('btn-danger');
                    $('button[name=visible-only]').addClass('btn-default');

                    $('button[name=disable-only]').removeClass('btn-success');
                    $('button[name=disable-only]').removeClass('btn-danger');
                    $('button[name=disable-only').addClass('btn-default');

                    $(element).removeClass('btn-default');
                    $(element).removeClass('btn-danger');
                    $(element).addClass('btn-success');
                    $('#search-text').focus();
                    is_active = 2;
                } else {
                    $(element).removeClass('btn-danger');
                    $(element).removeClass('btn-success');
                    $(element).addClass('btn-default');
                    $('#search-text').focus();
                    is_active = null;
                }
            }
            getUserDatabyDepartment();
        }

    async function getUserDatabyDepartment() {
            var showLoading = true
            if (showLoading) {
                await page.loading();
            }
            var table = $('#user-data-table').DataTable();
            table.destroy();
            var tr = '';
            var filteroption = "";
            //box('#search-quotation-panel').loading();
        if (document.getElementById("search-text").value != "") {
                filteroption = filteroption + "&username=" + document.getElementById("search-text").value;
        }
        if (document.getElementById("ddlserchDepartmentID").value != 0) {
                filteroption = filteroption + "&departmentid=" + document.getElementById("ddlserchDepartmentID").value;
        }
        if (document.getElementById("ddlserchRoleID").value != 0) {
            filteroption = filteroption + "&role=" + document.getElementById("ddlserchRoleID").value;
        }

        if (is_active != null && is_active != 2) {
                filteroption = filteroption + "&is_active=" + is_active;
        }

        if (document.getElementById("search-text").value == "" && document.getElementById("ddlserchDepartmentID").value == 0 && document.getElementById("ddlserchRoleID").value == 0 && is_active == null) {
                tr += `
                       <tr>
                           <td class="text-center" style="vertical-align: middle;">&nbsp;</td>
                           <td class="text-center" style="vertical-align: middle;">&nbsp;</td>
                           <td class="text-center" style="vertical-align: middle;">ไม่พบข้อมูล</td>
                           <td class="text-center" style="vertical-align: middle;">&nbsp;</td>
                           <td class="text-center" style="vertical-align: middle;">&nbsp;</td>
                       </tr>
                     `;
                $('#user-data-table tbody').empty().append(tr);
                $('#user-data-table').DataTable({
                    "processing": true,


        });
                // hide loader
        if (showLoading) {
                    await page.loaded();
        }
            $('#search-result').hide();
         return;
    }

        var userdata = await get(`${baseUrl}/homecare/api/v1/Search/GetSearchEmployeeDetail?` + filteroption);
        if (userdata.length) {
                editUserData = userdata;
                var counter = 0;
            for (var u of userdata) {
                counter++;
                    tr += `
                       <tr>

                           <td class="text-right" style="vertical-align: right;">${counter}</td>
                           <td class="text-left" style="vertical-align: left;">
                                <a href="javascript:editUser(${u.UserId});">
                             ${u.UserLogon}
                            </a>
                           </td>
                           <td class="text-left" style="vertical-align: left;">${u.UserFullName}</td>
                           <td class="text-left" style="vertical-align: left;">${u.DepartmentDesc}</td>
                           <td class="text-left" style="vertical-align: left;">${u.RoleDesc}</td>
                       </tr>
                     `;
                }
            $('#user-data-table tbody').empty().append(tr);
            $('#search-result').show();
        }

        else
              {
                tr += `
                       <tr>

                           <td class="text-center" style="vertical-align: middle;">&nbsp;</td>
                           <td class="text-center" style="vertical-align: middle;">&nbsp;</td>
                           <td class="text-center" style="vertical-align: middle;">ไม่พบข้อมูล</td>
                           <td class="text-center" style="vertical-align: middle;">&nbsp;</td>
                           <td class="text-center" style="vertical-align: middle;">&nbsp;</td>
                       </tr>
                     `;
            $('#user-data-table tbody').empty().append(tr);
            $('#search-result').hide();
        }

         var t =    $('#user-data-table').DataTable({
                "processing": true,
                "language": {
                    "search": "ค้นหา : ",
                    "lengthMenu": "แสดง _MENU_ รายการ",
                    "emptyTable": "ไม่พบข้อมูล",
                    "info": "รายการ _START_ ถึง _END_ จาก _TOTAL_ รายการ",
                    "paginate": {
                        "first": "หน้าแรก",
                        "last": "หน้าสุดท้าย",
                        "next": "ถัดไป",
                        "previous": "ก่อนหน้า"
                    }
                }
            });


            t.on('order.dt search.dt', function () {
                t.column(0, { search: 'applied', order: 'applied' }).nodes().each(function (cell, i) {
                    cell.innerHTML = i + 1;
                });
            }).draw();
            $('#search-result').show();
                // hide loader
            if (showLoading) {
                    await page.loaded();
            }
    }

        async function getNON_UserData() {
            var showLoading = true
            if (showLoading) {
                await page.loading();
            }
            var table = $('#non_user-data-table').DataTable();
            table.destroy();
            var tr = '';
            //var filteroption = "";
            ////box('#search-quotation-panel').loading();
            //if (document.getElementById("search-text").value != "") {
            //    filteroption = filteroption + "&username=" + document.getElementById("search-text").value;
            //}
            //if (document.getElementById("ddlserchDepartmentID").value != 0) {
            //    filteroption = filteroption + "&departmentid=" + document.getElementById("ddlserchDepartmentID").value;
            //}
            //if (document.getElementById("ddlserchRoleID").value != 0) {
            //    filteroption = filteroption + "&role=" + document.getElementById("ddlserchRoleID").value;
            //}

            //if (is_active != null && is_active != 2) {
            //    filteroption = filteroption + "&is_active=" + is_active;
            //}

            //if (document.getElementById("search-text").value == "" && document.getElementById("ddlserchDepartmentID").value == 0 && document.getElementById("ddlserchRoleID").value == 0 && is_active != 2) {
            //    tr += `
            //           <tr>
            //               <td class="text-center" style="vertical-align: middle;">&nbsp;</td>
            //               <td class="text-center" style="vertical-align: middle;">&nbsp;</td>
            //               <td class="text-center" style="vertical-align: middle;">ไม่พบข้อมูล</td>
            //               <td class="text-center" style="vertical-align: middle;">&nbsp;</td>
            //               <td class="text-center" style="vertical-align: middle;">&nbsp;</td>
            //           </tr>
            //         `;
            //    $('#user-data-table tbody').empty().append(tr);
            //    $('#user-data-table').DataTable({
            //        "processing": true,
            //    });
            //    // hide loader
            //    if (showLoading) {
            //        await page.loaded();
            //    }
            //    return;
            //}

             non_userdata = await get(`${baseUrl}/homecare/api/v1/Search/GetEmployeeNonMappingRole`);
            //var userdata = await get(`${baseUrl}/homecare/api/v1/Search/GetEmployeeMappingRole?`);
            if (non_userdata.length) {
                //editUserData = userdata;
                var counter = 0;
                for (var u of non_userdata) {
                    if (u.DepartmentDesc == null) {
                        u.DepartmentDesc = "";
                    }
                    if (u.RoleDesc == null) {
                        u.RoleDesc  = "";
                    }
                    counter++;
                    tr += `
                       <tr>
                           <td class="text-right" style="vertical-align: right;">${counter}</td>
                           <td class="text-left" style="vertical-align: left;">
                                <a href="javascript:createUser(${u.UserId});">
                             ${u.UserLogon}
                            </a>
                           <td class="text-left" style="vertical-align: left;">${u.UserFullName}</td>
                           <td class="text-left" style="vertical-align: left;">${u.DepartmentDesc}</td>

                       </tr>
                     `;
                    //<td class="text-center" style="vertical-align: middle;">${u.RoleDesc}</td>
                }
                $('#non_user-data-table tbody').empty().append(tr);
                $('#create-box').show();
            }
            else {
                tr += `
                       <tr>

                           <td class="text-center" style="vertical-align: middle;">&nbsp;</td>
                           <td class="text-center" style="vertical-align: middle;">&nbsp;</td>
                           <td class="text-center" style="vertical-align: middle;">ไม่พบข้อมูล</td>
                           <td class="text-center" style="vertical-align: middle;">&nbsp;</td>
                       </tr>
                     `;
                $('#non_user-data-table tbody').empty().append(tr);
                $('#create-box').hide();
            }

          var t =   $('#non_user-data-table').DataTable({
                "processing": true,
                "language": {
                    "search": "ค้นหา : ",
                    "lengthMenu": "แสดง _MENU_ รายการ",
                    "emptyTable": "ไม่พบข้อมูล",
                    "info": "รายการ _START_ ถึง _END_ จาก _TOTAL_ รายการ",
                    "paginate": {
                        "first": "หน้าแรก",
                        "last": "หน้าสุดท้าย",
                        "next": "ถัดไป",
                        "previous": "ก่อนหน้า"
                    }
                }
            });

            t.on('order.dt search.dt', function () {
                t.column(0, { search: 'applied', order: 'applied' }).nodes().each(function (cell, i) {
                    cell.innerHTML = i + 1;
                });
            }).draw();
            $('#search-result').show();


            // hide loader
            if (showLoading) {
                await page.loaded();
            }
        }

    // bind dropdown list
    function bindingDdlist(ddlId, ddlData, selectedVal) {
            $(`#${ddlId}`).empty();
            $.each(ddlData, (i, d) => {
                if (d.id == 0) {
                    $(`#${ddlId}`).append(`<option value="" selected  style="color:gray;">${d.description}</option>`);
                } else if (selectedVal == d.id) {
                    $(`#${ddlId}`).append(`<option value="${d.id}" selected>${d.description}</option>`);
                } else {
                    $(`#${ddlId}`).append(`<option value="${d.id}" >${d.description}</option>`);
                }
            })
    }

    async function createUserTab(e) {
            var link = $('#mytabs .active').next().children('a').attr('href');
        $('#mytabs a[href="' + link + '"]').tab('show');
        $('#create-box').hide();
            getNON_UserData();
    }

    function searchUserTab(e) {

       var link = "#home";
       $('#mytabs a[href="' + link + '"]').tab('show');
       //frmCreateUserData.resetForm();
       //frmCreateUserData.reset();
       //$('#frmCreateUserData').find(".error").removeClass("error");
       //cancel = false;
       //$('#create-box').hide();
    }
    async  function editUserTab(e) {
            $.each(provinceList, (i, d) => {
                $(`#ddlProvince`).append(`<option value="${d.id}" >${d.description}</option>`);
            })

            await getAmphorList();
            await getTambolList();
            var link = '#editUser';
            var hiden = '#create';
            $('#mytabs a[href="' + link + '"]').tab('show');
            cancel = false;
    }
    function cancelToTab(e) {
            var link = "#home";
            $('#mytabs a[href="' + link + '"]').tab('show');
            frmCreateUserData.resetForm();
            frmCreateUserData.reset();
            $('#frmCreateUserData').find(".error").removeClass("error");
            cancel = true;
    }
    function editUser(id) {
        $('#modalSaveData').modal({ backdrop: 'static', keyboard: false, show: true });
        $('#modalSaveData').modal('show');
        $("#frmEdit")[0].reset();
        $('.error').hide();
        let userSelected = editUserData.filter(user => user.UserId == id);

        $("#editUsername").val(userSelected[0].UserLogon);
        $("#editFullname").val(userSelected[0].UserFullName);
        $("#ddleditRoleID").val(userSelected[0].RoleID).trigger('change');
        showUserStatus(userSelected[0].IsActive);
        selectedUserId = id;
    }

   function createUser(id) {
       $('#modalCreateData').modal({ backdrop: 'static', keyboard: false, show: true });
       $('#modalCreateData').modal('show');
       $('.error').hide();
       $("#frmCreate")[0].reset();
       let userSelected = non_userdata.filter(user => user.UserId == id);

       $("#createUsername").val(userSelected[0].UserLogon);
       $("#createFullname").val(userSelected[0].UserFullName);
       $('#ddlcreateRoleID').val(0).trigger('change');
       userStatus = 1;
       selectedUserId = id;

    }

    function SaveData(mode) {
            var role = null;
            if (mode == "create") {
                role = $('#ddlcreateRoleID').val();
            } else {
                role = $('#ddleditRoleID').val();
            }

        value = {
            "userId": selectedUserId,
            "roleId": role,
            "isActive": userStatus,
            "userLogin": '@UserDetail.CodeName'
        }
        ajaxPost(`${baseUrl}/homecare/api/v1/User/InserAndUpdatetUserData`, value, response => {
            if (response.data) {
                console.log('OK')
                showModalLineApprveSuccess('บันทึกข้อมูลสำเร็จ');
                page.loaded();
            }
        });
   }

    function showModalLineApprveWarning(msg) {
            $('#modalRoleWarning').modal('show');
            $('#lbTxtWarning').text(msg);
        }
    function showModalLineApprveSuccess(msg) {
            $('#modalInsertRoleSuccess').modal('show');
            $('#lbTxtSuccess').text(msg);
        }

    $(".nav-tabs a[data-toggle=tab]").on("click", function (e) {
            if ($(this).hasClass("disabled")) {
                e.preventDefault();
                return false;
            }
    });

    $('#createFirstName').bind('keyup blur', function () {
            var thistext = $(this);
            thistext.val(thistext.val().replace(/[^A-Za-z]/gi, ''));
        });

    $('#createLastName').bind('keyup blur', function () {
            var thistext = $(this);
            thistext.val(thistext.val().replace(/[^A-Za-z]/gi, ""));
        });

    $('#FirstName').bind('keyup blur', function () {
            var thistext = $(this);
            thistext.val(thistext.val().replace(/[^A-Za-z]/gi, ''));
        });
    $('#LastName').bind('keyup blur', function () {
            var thistext = $(this);
            thistext.val(thistext.val().replace(/[^A-Za-z]/gi, ""));
        });
    $('#createUserCode').bind('keyup blur', function () {
            var thistext = $(this);

            thistext.val(thistext.val().replace(/[^A-Za-z._-]/gi, ""));
        });

    $('#createUserCode').bind('keyup blur', function () {
            var thistext = $(this);

            thistext.val(thistext.val().replace(/[^A-Za-z._-]/gi, ""));
        });
    $('#createFirstNameTH').bind('keyup blur', function () {
            var thistext = $(this);

            thistext.val(thistext.val().replace(/[^\u0E00-\u0E7F' ]|^'|'$|''"/gi, ""));
        });
    $('#createLastNameTH').bind('keyup blur', function () {
            var thistext = $(this);

            thistext.val(thistext.val().replace(/[^\u0E00-\u0E7F' ]|^'|'$|''"/gi, ""));
        });

    $('#FirstNameTH').bind('keyup blur', function () {
            var thistext = $(this);

            thistext.val(thistext.val().replace(/[^\u0E00-\u0E7F' ]|^'|'$|''"/gi, ""));
        });
    $('#LastNameTH').bind('keyup blur', function () {
            var thistext = $(this);

            thistext.val(thistext.val().replace(/[^\u0E00-\u0E7F' ]|^'|'$|''"/gi, ""));
        });

    $('#createIDCard').bind('keyup blur', function () {
            var thistext = $(this);

            thistext.val(thistext.val().replace(/[^0-9]/g, ""));
        });
    $('#IDCard').bind('keyup blur', function () {
            var thistext = $(this);

            thistext.val(thistext.val().replace(/[^0-9]/g, ""));
        });

    $('#FloorNo').bind('keyup blur', function () {
            var thistext = $(this);

            thistext.val(thistext.val().replace(/[^0-9]/g, ""));
        });

    $('#createFloorNo').bind('keyup blur', function () {
            var thistext = $(this);

            thistext.val(thistext.val().replace(/[^0-9]/g, ""));
        });

    $('#createMooNo').bind('keyup blur', function () {
            var thistext = $(this);

            thistext.val(thistext.val().replace(/[^0-9]/g, ""));
        });
    $('#MooNo').bind('keyup blur', function () {
            var thistext = $(this);

            thistext.val(thistext.val().replace(/[^0-9]/g, ""));
    });


    $('#btnCloseEditModal').click(function () {
            $('#modalSaveData').modal('hide');
    });
    $('#btnCloseCreateModal').click(function () {
            $('#modalCreateData').modal('hide');
    });

    function showUserStatus(status) {

            if (status == 1) {
                $('button[name=btneditInActive]').removeClass('btn-success');
                $('button[name=btneditInActive]').addClass('btn-default');
                $('button[name = btneditActive]').addClass('btn-success');
                userStatus = 1;

            } else {

                $('button[name=btneditActive]').removeClass('btn-success');
                $('button[name=btneditActive]').addClass('btn-default');
                $('button[name = btneditInActive]').addClass('btn-success');
                userStatus = 0;
            }
        }

        function validateEditForm() {

            checkEditValidation = true;
            $('.error').hide();
            if ($('#ddleditRoleID').val() == 0 || $('#ddleditRoleID').val() == undefined) {

                $('#ddleditRoleID').after('<span class="error"> Please Select Role </span>');
                checkEditValidation = false;
            }
        }

        function validateCreateForm() {
            checkCreateValidation = true;
            $('.error').hide();
            if ($('#ddlcreateRoleID').val() == 0 || $('#ddlcreateRoleID').val() ==undefined) {

                $('#ddlcreateRoleID').after('<span class="error"> Please Select Role </span>');
                checkCreateValidation = false;
            }


        }

        function redirectURL() {

            window.location.href = window.location.pathname;
        }

    </script>

}


